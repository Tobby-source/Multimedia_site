<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multimedia Hub</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f9;
        margin: 0;
        padding: 0;
        color: #860ae4;
    }

    header {
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 20px 0;
    }

    header h1 {
        margin: 0;
        font-size: 2.5em;
    }

    .marquee {
        background-color: #e74c3c;
        color: white;
        padding: 10px 0;
        font-weight: bold;
    }

    .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        padding: 20px;
    }

    .media-card {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        padding: 15px;
        text-align: center;
        transition: transform 0.2s;
        cursor: pointer;
        position: relative;
    }

    .media-card:hover {
        transform: translateY(-5px);
    }

    .media-card h3 {
        margin: 10px 0;
        font-size: 1.2em;
        color: #2c3e50;
    }

    video, audio, img {
        width: 100%;
        max-height: 200px;
        border-radius: 8px;
    }

    .fullscreen-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(0,0,0,0.5);
        color: white;
        border: none;
        padding: 5px 8px;
        border-radius: 5px;
        cursor: pointer;
    }

    .playlist {
        background-color: #fff;
        margin: 20px;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        text-align: center;
    }

    .playlist h2 {
        margin-bottom: 15px;
        color: #2c3e50;
    }

    button.play-all-btn {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 1em;
        border: none;
        border-radius: 5px;
        background-color: #2c3e50;
        color: white;
        cursor: pointer;
    }

    button.play-all-btn:hover {
        background-color: #34495e;
    }

    @media (max-width: 600px) {
        video, audio, img {
            max-height: 150px;
        }
    }
</style>
</head>
<body>

<header>
    <h1>Multimedia Hub</h1>
</header>

<div class="marquee">
    <marquee>Check out our latest media below!</marquee>
</div>

<div class="gallery">
    {% if media %}
        {% for item in media %}
            <div class="media-card">
                <h3>{{ item.title }}</h3>

                {% with item.file.url|lower as url %}
                    {% if ".mp4" in url %}
                        <video controls>
                            <source src="{{ item.file.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% elif ".mp3" in url %}
                        <audio controls>
                            <source src="{{ item.file.url }}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    {% else %}
                        <img src="{{ item.file.url }}" alt="{{ item.title }}">
                    {% endif %}
                {% endwith %}

                <button class="fullscreen-btn" onclick="openFullscreen(this)">⤢ Fullscreen</button>
            </div>
        {% endfor %}
    {% else %}
        <p style="grid-column: 1/-1; text-align:center;">No media available at the moment. Please check back later.</p>
    {% endif %}
</div>

<!-- Unified Playlist Player -->
<div class="playlist">
    <h2>Unified Playlist - Play All</h2>
    <div id="player-container">
        <video id="unified-player" controls width="90%" style="max-height: 400px; display: none;"></video>
        <audio id="unified-audio" controls style="width: 90%; display: none;"></audio>
    </div>
    <br>
    <button class="play-all-btn" onclick="playPlaylist()">▶ Play All</button>
</div>

<script>
    // Fullscreen functionality
    function openFullscreen(button) {
        const card = button.parentElement;
        const media = card.querySelector('video, audio, img');

        if (media.requestFullscreen) {
            media.requestFullscreen();
        } else if (media.mozRequestFullScreen) {
            media.mozRequestFullScreen();
        } else if (media.webkitRequestFullscreen) {
            media.webkitRequestFullscreen();
        } else if (media.msRequestFullscreen) {
            media.msRequestFullscreen();
        }
    }

    // Unified Playlist Functionality
    const playlistMedia = [
        {% for item in media %}
            {% with item.file.url|lower as url %}
                {% if ".mp4" in url %}
                    { url: "{{ item.file.url }}", type: "video" },
                {% elif ".mp3" in url %}
                    { url: "{{ item.file.url }}", type: "audio" },
                {% endif %}
            {% endwith %}
        {% endfor %}
    ];

    let currentIndex = 0;
    const videoPlayer = document.getElementById('unified-player');
    const audioPlayer = document.getElementById('unified-audio');

    function playPlaylist() {
        if (!playlistMedia.length) return;
        currentIndex = 0;
        playMedia(playlistMedia[currentIndex]);
    }

    function playMedia(media) {
        // Hide both players
        videoPlayer.style.display = 'none';
        audioPlayer.style.display = 'none';
        videoPlayer.pause();
        audioPlayer.pause();

        if (media.type === "video") {
            videoPlayer.src = media.url;
            videoPlayer.style.display = 'block';
            videoPlayer.play();
            videoPlayer.onended = nextMedia;
        } else if (media.type === "audio") {
            audioPlayer.src = media.url;
            audioPlayer.style.display = 'block';
            audioPlayer.play();
            audioPlayer.onended = nextMedia;
        }
    }

    function nextMedia() {
        currentIndex++;
        if (currentIndex < playlistMedia.length) {
            playMedia(playlistMedia[currentIndex]);
        }
    }
</script>

</body>
</html>
